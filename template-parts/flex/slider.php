<?php
$slides = get_sub_field('carousel');

if ($slides) {
	$carousel_type = get_sub_field('type');
	$showcase = ($carousel_type === 'showcase') ? true:false;
	$opts = array(
		'animateOut' => (get_sub_field('transition') === 'linear') ? false:get_sub_field('transition'),
		'autoplayTimeout' => get_sub_field('speed'),
		'loop' => get_sub_field('loop'),
		'items' => ($showcase) ? 3:(int)get_sub_field('number_to_show'),
		'nav' => get_sub_field('indicators'),
		'dots' => get_sub_field('navigation'),
		'center' => $showcase,
	);
?>
<section class="flex-carousel<?= ($carousel_type) ? ' '.$carousel_type:''; ?>">
	<div class="slider" data-carousel-options='<?= json_encode($opts) ?>'>
		<div class="swiper-wrapper">
		
			<?php
			foreach ($slides as $key => $slide) {
				?>
				<div class="swiper-slide has-desktop<?= ($slide['mobile_image']['ID']) ? ' has-mobile':''; ?><?= (!$slide['background_image']) ? ' no-bg':''; ?>">
					<?= wp_get_attachment_image( $slide['background_image']['ID'], 'full-width', false, array('class' => 'img-fluid desktop-img') ); ?>
					<?= wp_get_attachment_image( $slide['mobile_image']['ID'], 'large', false, array('class' => 'img-fluid mobile-img') ); ?>
					
					<?php
					if ($carousel_type === 'cta') {
						$foreground_image = $slide['foreground_image'];
						$alignment = $slide['alignment'];
						switch ($alignment) {
							case 'left':
								$textalign = '';
								break;
							case 'center':
								$textalign = ' offset-md-3';
								$imgalign = ' offset-md-3';
								break;
							case 'right':
								$textalign = ($foreground_image) ? ' order-md-1':' offset-md-6';
								break;
							default:
								$textalign = '';
								break;
						}
						?>
						<div class="carousel-text">
							<div class="container">
								<div class="row align-self-center">
									<div class="col-12 col-md-6<?= $textalign ?>">
										<?php
										if ($slide['text']) {
											echo $slide['text'];
										}
										?>
										
										<?php if ( $slide['buttons'] ) { ?>
											<div class="carousel-buttons">
												<?php
												foreach ( $slide['buttons'] as $btnkey => $button ) {
													echo '<a href="' . $button['button_link'] . '" class="btn btn-primary btn-lg button' . ($btnkey + 1) . '">'.$button['button_text'].'</a>';
												}
												?>
										</div>
										<?php } ?>
									</div>
									<?php if ($foreground_image) { ?>
										<div class="col-12 col-md-6<?= $imgalign ?>">
											<?= wp_get_attachment_image( $foreground_image, 'large', false, array('class' => 'img-fluid') ); ?>
										</div>
									<?php } ?>
								</div>
							</div>
						</div>
					<?php } ?>
				</div>
				<?php
			}
			?>
		</div>
	</div>
</section>
<?php
}
